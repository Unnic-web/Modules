__version__ = (1, 0, 3)
#ã…¤ã…¤ã…¤ã…¤ã…¤ã…¤ã…¤ã…¤ã…¤ã…¤Â© Copyright 2024
#ã…¤ã…¤ã…¤ã…¤ã…¤ã…¤ã…¤ã…¤ã…¤ã…¤https://t.me/unnic
# ğŸ”’ã…¤ã…¤ã…¤ã…¤ã…¤Licensed under the GNU AGPLv3
# ğŸŒã…¤ã…¤https://www.gnu.org/licenses/agpl-3.0.html
#â”â”“â”â”â”“â”â”â”â”“â”â”â”â”“â”â”â”â”â”â”â”â”“â”â”â”â”â”â”â”“â”â”â”â”â”â”â”â”â”â”â”â”
#â”ƒâ”ƒâ”â”ƒâ”ƒâ”â”â”ƒâ”ƒâ”â”â”ƒâ”ƒâ”â”â”ƒâ”â”“â”â”“â”ƒâ”â”â”â”â”â”›â”—â”“â”â”â”â”â”â”â”â”â”â”â”
#â”ƒâ”—â”â”›â”ƒâ”â”“â”ƒâ”ƒâ”â”“â”ƒâ”ƒâ”â”“â”—â”›â”ƒâ”ƒâ”—â”›â”â”“â”â”“â”—â”“â”â”›â”â”â”â”“â”â”â”“â”â”â”â”
#â”ƒâ”â”â”“â”ƒâ”£â”«â”ƒâ”—â”›â”›â”ƒâ”—â”›â”›â”â”â”ƒâ”ƒâ”â”â”ƒâ”ƒâ”ƒâ”ƒâ”â”ƒâ”ƒâ”â”ƒâ”â”“â”ƒâ”ƒâ”â”›â”â”â”â”
#â”ƒâ”ƒâ”â”ƒâ”ƒâ”ƒâ”ƒâ”ƒâ”â”“â”“â”ƒâ”â”“â”“â”â”â”›â”—â”“â”â”ƒâ”—â”›â”ƒâ”â”ƒâ”—â”“â”ƒâ”—â”›â”ƒâ”ƒâ”ƒâ”â”â”â”â”
#â”—â”›â”â”—â”›â”—â”›â”—â”›â”—â”›â”—â”›â”—â”›â”â”—â”â”â”›â”â”—â”â”â”›â”â”—â”â”›â”—â”â”â”›â”—â”›â”â”â”â”â”
#â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
#â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# meta banner: https://t.me/HikkTutor
# meta developer: @unnic
#â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
#â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
#â–ˆâ–ˆâ•—â–‘â–‘â–‘â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—â–‘â–‘â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—â–‘â–‘â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–‘
#â–ˆâ–ˆâ•‘â–‘â–‘â–‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ•—â–‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ•—â–‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—
#â–ˆâ–ˆâ•‘â–‘â–‘â–‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–‘â–‘â•šâ•â•
#â–ˆâ–ˆâ•‘â–‘â–‘â–‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–‘â–‘â–ˆâ–ˆâ•—
#â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–‘â•šâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–‘â•šâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•
#â–‘â•šâ•â•â•â•â•â•â–‘â•šâ•â•â–‘â–‘â•šâ•â•â•â•šâ•â•â–‘â–‘â•šâ•â•â•â•šâ•â•â–‘â•šâ•â•â•â•â•
#â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
#â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

from .. import loader, utils
from telethon.tl.types import Message  # type: ignore
import requests # type: ignore

# ---------------------Module-----------------------
class CurrencyMod(loader.Module):
    """ĞœĞ¾Ğ´ÑƒĞ»ÑŒ Ğ´Ğ»Ñ ÑÑ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ñ ĞºÑƒÑ€ÑĞ¾Ğ²"""

    strings = {
        "name": "Currency",
        "inc_args": "â„¹ï¸ <b>ĞĞµĞ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğµ Ğ°Ñ€Ğ³ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹</b>",
        "keyerror": "â„¹ï¸ <b>Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾, Ğ²Ğ°Ğ»ÑÑ‚Ğ° Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ Ğ² Ğ±Ğ°Ğ·Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… ÑĞ°Ğ¹Ñ‚Ğ° Ğ¸Ğ»Ğ¸ Ğ²Ñ‹ Ğ²Ğ²ĞµĞ»Ğ¸ Ğ½ĞµĞ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾Ğµ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ.</b>",
        "currency_not_supported": "â„¹ï¸ <b>Ğ”Ğ°Ğ½Ğ½Ğ°Ñ Ğ²Ğ°Ğ»ÑÑ‚Ğ° Ğ½Ğµ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ. ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ.</b>"
    }

# ---------------Tagged functionality----------------
    async def cvcmd(self, message: Message):
        """Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ .cv <Ñ‡Ğ¸ÑĞ»Ğ¾> <Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ²Ğ°Ğ»ÑÑ‚Ñ‹>."""
        args = utils.get_args_raw(message)
        tray = "RUB"
        if not args:
            args = "1 " + tray

        args_list = args.split()
        try:
            if len(args_list) == 1 and isinstance(float(args_list[0]), float):
                args_list.append(str(tray))
        except Exception:
            args_list = ["1", args_list[0]]

        currency = args_list[1].upper()
        api_url = f"https://min-api.cryptocompare.com/data/price?fsym={currency}&tsyms=USD,RUB,UAH,KZT,EUR,BYN,GBP,CHF,JPY,TON,NOT"
        api_response = requests.get(api_url).json()

        user = await message.get_sender()
        is_premium = user.premium

        if 'Response' in api_response and api_response['Response'] == 'Error':
            await utils.answer(message, self.strings("currency_not_supported"))
            return

        try:
            count = float(args_list[0])

            currency_symbols = {
                "USD": "ğŸ‡ºğŸ‡¸", "RUB": "ğŸ‡·ğŸ‡º", "UAH": "ğŸ‡ºğŸ‡¦", "KZT": "ğŸ‡°ğŸ‡¿", "EUR": "ğŸ‡ªğŸ‡º", 
                "BYN": "ğŸ‡§ğŸ‡¾", "GBP": "ğŸ‡¬ğŸ‡§", "CHF": "ğŸ‡¨ğŸ‡­", "JPY": "ğŸ‡¯ğŸ‡µ", "TON": "ğŸ”µ", 
                "NOT": "âš«ï¸"
            }

            emoji_symbols = {
                "USD": "<emoji document_id=5202021044105257611>ğŸ‡ºğŸ‡¸</emoji>", 
                "RUB": "<emoji document_id=5449408995691341691>ğŸ‡·ğŸ‡º</emoji>",
                "UAH": "<emoji document_id=5447309366568953338>ğŸ‡ºğŸ‡¦</emoji>", 
                "KZT": "<emoji document_id=5228718354658769982>ğŸ‡°ğŸ‡¿</emoji>",
                "EUR": "<emoji document_id=5228784522924930237>ğŸ‡ªğŸ‡º</emoji>", 
                "BYN": "<emoji document_id=5382219601054544127>ğŸ‡§ğŸ‡¾</emoji>",
                "GBP": "<emoji document_id=5202196682497859879>ğŸ‡¬ğŸ‡§</emoji>", 
                "CHF": "<emoji document_id=5442703336266543270>ğŸ‡¨ğŸ‡­</emoji>",
                "JPY": "<emoji document_id=5456261908069885892>ğŸ‡¯ğŸ‡µ</emoji>", 
                "TON": "<emoji document_id=5253691721174234015>ğŸ’</emoji>",
                "NOT": "<emoji document_id=5379965911455256722>ğŸ’</emoji>"
            }

            form = f"<b>ĞŸĞ¾Ğ¸ÑĞº Ğ¿Ğ¾ ĞºÑƒÑ€ÑÑƒ: {count} {currency}</b>\n<b>Ğ¡Ğ²ĞµĞ¶Ğ¸Ğµ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹:</b>\n\n"

            for curr, symbol in currency_symbols.items():
                if curr == currency:
                    continue

                value = round(api_response.get(curr, 0) * count, 2)
                value_str = f"{value:,.2f}".replace(",", "X").replace(".", ",").replace("X", ".")

                if is_premium:
                    flag = emoji_symbols.get(curr, "")
                else:
                    flag = symbol

                form += f"{flag} <code>{value_str}</code> {curr}\n"

            await utils.answer(message, form)

        except KeyError:
            await utils.answer(message, self.strings("keyerror"))
        except ValueError:
            await utils.answer(message, self.strings("inc_args"))

#-------Functionality with list and with tags-------
    async def cvicmd(self, message: Message):
        """Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ… Ğ²Ğ°Ğ»ÑÑ‚"""
    
        user = await message.get_sender()
        is_premium = user.premium
        instruction = (
           "<b>Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ²Ğ°Ğ»ÑÑ‚</b>\n\n"
           f"{'ğŸ‡ºğŸ‡¸' if not is_premium else '<emoji document_id=5202021044105257611>ğŸ‡ºğŸ‡¸</emoji>'}"
           "<code>USD</code><b>(Ğ”Ğ¾Ğ»Ğ»Ğ°Ñ€)</b>\n"
           f"{'ğŸ‡·ğŸ‡º' if not is_premium else '<emoji document_id=5449408995691341691>ğŸ‡·ğŸ‡º</emoji>'}"
           "<code>RUB</code> <b>(Ğ ÑƒĞ±Ğ»ÑŒ)</b>\n"
           f"{'ğŸ‡ºğŸ‡¦' if not is_premium else '<emoji document_id=5447309366568953338>ğŸ‡ºğŸ‡¦</emoji>'}"
           "<code>UAH</code> <b>(Ğ“Ñ€Ğ¸Ğ²Ğ½Ğ°)</b>\n"
           f"{'ğŸ‡°ğŸ‡¿' if not is_premium else '<emoji document_id=5228718354658769982>ğŸ‡°ğŸ‡¿</emoji>'}"
           "<code>KZT</code> <b>(Ğ¢ĞµĞ½Ğ³Ğµ)</b>\n"
           f"{'ğŸ‡ªğŸ‡º' if not is_premium else '<emoji document_id=5228784522924930237>ğŸ‡ªğŸ‡º</emoji>'}"
           "<code>EUR</code> <b>(Ğ•Ğ²Ñ€Ğ¾)</b>\n"
           f"{'ğŸ‡§ğŸ‡¾' if not is_premium else '<emoji document_id=5382219601054544127>ğŸ‡§ğŸ‡¾</emoji>'}"
           "<code>BYN</code> <b>(Ğ‘ÑƒĞ½)</b>\n"
           f"{'ğŸ‡¬ğŸ‡§' if not is_premium else '<emoji document_id=5202196682497859879>ğŸ‡¬ğŸ‡§</emoji>'}"
           "<code>GBP</code> <b>(Ğ¤ÑƒĞ½Ñ‚)</b>\n"
           f"{'ğŸ‡¨ğŸ‡­' if not is_premium else '<emoji document_id=5442703336266543270>ğŸ‡¨ğŸ‡­</emoji>'}"
           "<code>CHF</code> <b>(Ğ¤Ñ€Ğ°Ğ½Ğº)</b>\n"
           f"{'ğŸ‡¯ğŸ‡µ' if not is_premium else '<emoji document_id=5456261908069885892>ğŸ‡¯ğŸ‡µ</emoji>'}"
           "<code>JPY</code> <b>(Ğ™ĞµĞ½Ğ°)</b>\n"
           f"{'ğŸ”µ' if not is_premium else '<emoji document_id=5253691721174234015>ğŸ’</emoji>'}"
           "<code>TON</code> <b>(Ğ¢Ğ¾Ğ½ĞºĞ¾Ğ¸Ğ½)</b>\n"
           f"{'âš«ï¸' if not is_premium else '<emoji document_id=5379965911455256722>ğŸ’</emoji>'}"
           "<code>NOT</code> <b>(ĞĞ¾Ñ‚ĞºĞ¾Ğ¸Ğ½)</b>\n\n"
           "<b>Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ‡ĞµÑ€ĞµĞ·:</b> <code>.cv</code><Ñ‡Ğ¸ÑĞ»Ğ¾> <Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ>"
        )
        await message.edit(instruction, parse_mode='html')

        # Ğ¥ĞµÑ€ # Ğ¥ĞµÑ€Ğ½Ñ # Ğ¥ĞµÑ€Ğ°Ñ‚ĞµĞ½ÑŒ # ĞĞ°Ñ…ĞµÑ€ # Ğ—Ğ°Ñ…ĞµÑ€ # ĞŸĞ¾Ñ…ĞµÑ€
        # ĞœĞ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ                     # ĞĞµ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ
        # Ğ˜Ğ´ĞµÑ ĞĞ»ĞµĞºÑĞ°Ğ½Ğ´Ñ€Ğ°              # ĞšĞ¾Ğ´ĞµÑ€ ĞĞ»ĞµĞºÑĞ°Ğ½Ğ´Ñ€ 
        # ĞĞ²Ñ‚Ğ¾Ñ€Ñ‹     Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ    ĞĞ»ĞµĞºÑĞ°Ğ½Ğ´Ñ€    Ğ¸     Ğ’ÑÑĞºĞ¾Ğµ
        # ĞšĞ¾Ğ´ Ğ½Ğµ Ğ¿Ğ¸Ğ·Ğ´Ğ¸ĞµĞ¼ Ğ¸ Ğ½Ğµ Ğ¼ĞµĞ½ÑĞ¹Ñ‚Ğµ Ğ¸Ğ½Ğ°Ñ‡Ğµ Ğ·Ğ°ÑÑƒĞ¶Ñƒ Ğ½Ğ°Ñ…ÑƒĞ¹
        # ĞĞ²Ñ‚Ğ¾Ñ€ Ğ½Ğµ Ğ½ĞµÑÑ‘Ñ‚ Ğ¾Ñ‚Ğ²ĞµÑ‚ Ğ·Ğ° Ñ‚Ğ²Ğ¾Ğ¸ Ğ¿Ğ¾ÑĞ»ĞµĞ´ÑÑ‚Ğ²Ğ¸Ñ Ğ¿Ğ°Ğ´Ğ»Ğ°
        # ĞĞµ    Ğ±ÑƒĞ´ÑŒ    ĞµĞ±Ğ»Ğ°Ğ½Ğ¾Ğ¼   Ğ½Ğµ    Ğ»ĞµĞ·ÑŒ   Ğ²  ÑĞºÑ€Ğ¸Ğ¿Ñ‚
